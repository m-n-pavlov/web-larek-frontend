# Проектная работа "Веб-ларек"
https://github.com/m-n-pavlov/web-larek-frontend/

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ - исходные файлы проекта
- src/components/ - папка с JS компонентами
- src/components/base/ - папка с базовым кодом
- src/components/models/ - папка с моделями данных (модели каталога, корзины и заказа)
- src/components/views/ - папка с компонентами слоя представления
- src/components/views/card/ - папка с компонентами карточки товара (базовый компонент и его производные: карточка в каталоге, в превью и в корзине)
- src/components/views/form/ - папка с компонентами форм (базовый компонент и его производные для двух шагов оформления заказа)

Важные файлы:
- src/pages/index.html - HTML-файл главной страницы
- src/types/index.ts - файл с типами
- src/index.ts - точка входа приложения
- src/scss/styles.scss - корневой файл стилей
- src/utils/constants.ts - файл с константами
- src/utils/utils.ts - файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Данные и типы данных, используемые в приложении

Товар

```ts
interface IProduct {
  id: string;            // уникальный идентификатор товара
  title: string;         // название товара
  description: string;   // описание товара
  image: string;         // путь к изображению
  category: string;      // категория товара
  price: number | null;  // number (цена в синапсах) или null ("Бесценно")
}
```

Покупатель

```ts
export interface ICustomer {
  payment: 'card' | 'cash' | "";  // метод оплаты ("" - состояние по умолчанию, когда выбор не сделан)
  address: string;                // адрес доставки
  email: string;                  // email покупателя
  phone: string;                  // телефон покупателя
}
```

Данные товара в каталоге

```ts
type TCardCatalog = Omit<IProduct, 'description'>;
```

Данные выбранного товара в отдельном окне превью

```ts
type TCardPreview = IProduct;
```

Данные товара, добавленного в корзину

```ts
type TCardBasket = Pick<IProduct, 'id' | 'title' | 'price'>;
```

Тип данных для хранения ошибок в формах

```ts
export type TFormErrors = Partial<Record<keyof TFormOrder | keyof TFormContacts, string>>;
```

## Архитектура приложения

При построении архитектуры приложения используется MVP-паттерн:
- слой данных (Model) отвечает за хранение и изменение данных
- слой представления (View) отвечает за отображение данных на странице
- код управляющего слоя Presenter, координирующий работу Model и View размещен в корневом файле, точке входа приложения src/index.ts

### Базовый код

#### Класс Api

Назначение:
Базовый класс для работы с серверным API.
Обеспечивает единый интерфейс для выполнения HTTP-запросов к серверу и позволяет расширять его для конкретных модулей приложения.

Основные возможности:
- GET-запросы: получение данных с сервера
- POST-запросы: отправка данных на сервер
- Обработка URL и опций запроса: автоматически использует базовый URL и переданные заголовки/опции
- Позволяет создавать специализированные API-классы (например, WebLarekAPI) без дублирования логики работы с fetch

Используется в WebLarekAPI.ts для загрузки списка товаров и отправки заказов.

#### Класс EventEmitter

Назначение:
Система событий для обмена информацией между моделями и UI без прямой зависимости.
Позволяет организовать связь через события, что делает архитектуру более гибкой.

Основные методы, реализуемые классом описаны интерфейсом IEvents:
- on - подписка на событие
- emit - инициализация события
- trigger - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие 

Остальные методы, в том числе, не используемые в приложении предоставляют универсальность и возможность переиспользования класса.

### Слой данных

#### Класс Model

Назначение:
Базовая модель данных для хранения состояния приложения и его компонентов.
Обеспечивает единую точку правды для данных и уведомляет подписчиков через события о любых изменениях.

Основные возможности:
- Хранение состояния
- Связь с системой событий
- Универсальные методы

В приложении используется для моделей данных BasketModel, CatalogModel и CustomerModel.

Преимущества использования:
- Централизованное управление данными
- Реактивное обновление UI через события
- Минимизирует дублирование кода и упрощает тестирование

#### Класс CatalogModel

Наследует базовый класс Model и отвечает за хранение и логику работы с данными всех товаров в общем каталоге.
Конструктор класса принимает инстант брокера событий.

В полях класса хранятся следующие данные:
- products: IProduct[] - хранит массив всех товаров из API
- selectedProduct: string | null - хранит id выбранного товара
- events: IEvents - экземпляр класса EventEmitter для инициации событий при изменении данных

Набор методов для взаимодействия с этими данными:
- getProducts(): TProductPreview[] - возвращает массив товаров для каталога
- setProducts(products: IProduct[]): void - сохраняет полный массив товаров
- getSelectedProduct(): TProductDetails | null - возвращает объект выбранного товара по id
- setSelectedProduct(id: string | null): void - сохраняет id выбранного товара

#### Класс BasketModel
Наследует базовый класс Model и отвечает за хранение и логику работы с данными товаров в корзине.
Конструктор класса принимает инстант брокера событий.

В полях класса хранятся следующие данные:
- items: TCartData[] - массив товаров в корзине (title и price - для отображения, id - для логики)
- events: IEvents - экземпляр класса EventEmitter для инициации событий при изменении данных

Набор методов для взаимодействия с этими данными:
- addItem(item: TCartData): void - добавить товар в массив товаров в корзине, вызывает событие изменения массива
- removeItem(itemId: string): void - удалить товар из массива товаров в корзине, вызывает событие изменения массива
- getCount(): number - получить количество товаров в корзине
- getItems(): TCartData[] - получить список товаров в корзине
- getTotal(): number` - получить общую стоимость товаров в корзине
- containsItem(itemId: string): boolean - проверить, есть ли товар в корзине по ID
- clearItems(): void - очистить корзину

#### Класс OrderModel
Наследует базовый класс Model и отвечает за хранение и логику работы с данными заказа и покупателя.
Конструктор класса принимает инстант брокера событий.

В полях класса хранятся следующие данные:
- customer: ICustomer - все данные покупателя в соответствии с интерфейсом ICustomer
- events: IEvents - экземпляр класса EventEmitter для инициации событий при изменении данных
- formErrors: TFormErrors - тип для хранения ошибок в формах

Набор методов для взаимодействия с этими данными:
- getCustomerData(): ICustomer - получить данные покупателя
- setCustomerData(customerData: Partial<ICustomer>): void - сохранить/обновить данные покупателя
- validateCustomerData(step: 'shipping' | 'contacts'): boolean - проверить корректность данных покупателя
- clearCustomerData(): void - очистить данные покупателя
- setItems(items: string[]): void - устанавливает новые товары в заказ
- setTotal(total: number): void - устанавливает итоговую сумму заказа
- getOrderData(): IPostOrder - генерирует объект заказа для отправки на сервер

### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс Component

Назначение:
Абстрактный базовый класс для всех UI-компонентов проекта.
Упрощает работу с DOM и обеспечивает единообразие при создании элементов интерфейса.

Основные возможности:
- Позволяет наследникам реализовать специфичные методы рендера и обновления интерфейса
- Обеспечивает структуру компонента: каждый UI-объект работает через свой DOM-элемент, что упрощает управление и повторное использование

#### Класс Card

Общая информация
Базовый абстрактный компонент карточки товара — общий DOM- и логический функционал для всех видов карточек (заголовок, цена, работа с DOM).

Конструктор
constructor(container: HTMLElement, actions?: ICardActions)
— принимает корневой container (элемент карточки) и опциональные actions (onCardClick).

Поля класса
- protected _title: HTMLElement — элемент с заголовком (.card__title).
- protected _price: HTMLElement — элемент с ценой (.card__price).

Методы класса
- set id(value: string) - установить ID товара
- get id(): string - получить ID товара
- set title(value: string) — установить заголовок в DOM.
- get title(): string — вернуть текст заголовка.
- set price(value: number | null) — установить цену; использует handlePrice и выводит "Бесценно" при null.

#### Класс CardBasket

Общая информация
Расширяет класс Card.
Карточка товара для списка корзины — компактный вид с возможностью удаления и отображением индекса.

Конструктор
constructor(container: HTMLElement, actions?: ICardBasketActions)
— принимает элемент шаблона карточки корзины и опциональные actions (onDeleteClick).

Поля класса
- protected _button: HTMLButtonElement — кнопка удаления (.basket__item-delete).
- protected _index: HTMLElement — элемент для номера позиции (.basket__item-index).

Методы класса
- set index(value: number) — установить отображаемый индекс (1,2,3...).

#### Класс CardCatalog

Общая информация
Расширяет класс Card.
Карточка каталога — визуальная карточка для сетки каталога, поддерживает изображение и категорию.

Конструктор
constructor(container: HTMLElement, actions?: ICardActions)
— принимает элемент шаблона и опциональные actions

Поля класса
- protected _image: HTMLImageElement — элемент изображения (.card__image).
- protected _category: HTMLElement — элемент категории (.card__category).

Методы класса
- set image(value: string) — установить src и alt изображения (через setImage).
- set category(value: string) — установить текст категории и переключить CSS-класс по categoryMap.

#### Класс CardPreview

Общая информация
Расширяет класс Card.
Комплексная превью-карточка в модальном окне: детальное описание, кнопка добавления/удаления в корзину, управление состоянием кнопки в зависимости от цены. Не наследуется от Card — отдельная реализация для preview.

Конструктор
constructor(container: HTMLElement, actions?: ICardPreviewActions)
— принимает клонированный шаблон и объект с опциональными обработчиками действий

Поля класса
- _image: HTMLImageElement - элемент с картинкой
- _category: HTMLElement - элемент с категорией товара
- _description: HTMLElement - элемент с описанием товара
- _button: HTMLButtonElement - кнопку "Купить"/"Удалить" из корзины

Методы класса
- set image(v: string) — установить src изображения.
- set description(v: string) — обновить текст описания.
- set category(v: string) — обновить категорию текста.
- set price(v: number | null) — обновить цену в DOM и применить состояние кнопки.
- метод updateButtonText() - обновляет текст кнопки карточки в зависимости от того, находится ли товар в корзине

#### Класс Form

Общая информация
Базовый абстрактный класс формы: централизует работу с инпутами, сабмитом, отображением ошибок и состоянием валидности.

Конструктор
constructor(protected container: HTMLFormElement, protected events: IEvents)
— принимает сам `<form>` элемент и шину событий (events).

Поля класса
- protected _submit: HTMLButtonElement — кнопка отправки (`button[type=submit]`).
- protected _errors: HTMLElement — контейнер для сообщений об ошибках (.form__errors).

Методы класса
- protected onInputChange(field: keyof T, value: string) — эмитит orderInput:change при инпуте.
- set valid(value: boolean) — включает/отключает кнопку отправки.
- set errors(value: string) — устанавливает текст ошибок.
- render(state: Partial<T> & IFormState) — обновляет состояние формы и возвращает контейнер.

#### Класс FormContacts

Общая информация
Расширяет класс Form.
Форма ввода контактных данных: email и телефон с локальной валидацией и отображением ошибок.

Конструктор
constructor(template: HTMLElement, events: IEvents)
— принимает клонированный шаблон формы и шину событий.

Поля класса наследует от родительского класса Form

Методы класса
- set email(value: string) - обновляет значения поля формы с email
- set phone(value: string) - обновляет значения поля формы с телефоном

#### Класс FormOrder

Общая информация
Расширяет класс Form.
Форма шага доставки/оплаты: выбор способа оплаты (карта/нал), ввод адреса, валидация и возможность сброса выбранного способа.

Конструктор
constructor(template: HTMLElement, events: IEvents)
— принимает шаблон шага и шину событий.

Поля класса
- private _cardButton: HTMLButtonElement - кнопка выбора метода оплаты (карта)
- private _cashButton: HTMLButtonElement - кнопка выбора метода оплаты (при получении)

Методы класса
- setPayment(method: 'card' | 'cash') - отвечает за выбор способа оплаты
- set address(value: string) - присваивает указанное значение полю адрес
- disableButtons() - сбрасывает выделение кнопок оплаты

#### Класс Basket

Общая информация
Представление корзины: список элементов, общая сумма, кнопка перехода к оформлению. Используется как содержимое модалки при открытии корзины.

Конструктор
constructor(container: HTMLElement, events: IEvents)
— принимает корневой контейнер (клонированный шаблон корзины) и шину событий.

Поля класса
- protected _list: HTMLElement — контейнер списка (.basket__list).
- protected _total: HTMLElement — элемент отображения суммы (.basket__price).
- protected _button: HTMLButtonElement — кнопка "Оформить".

Методы класса
set items(items: HTMLElement[]) - обновляет список товаров в корзине
set selected(items: string[]) - включает или отключает кнопку перехода к оформлению заказа
set total(total: number) - обновляет отображение общей суммы корзины

#### Класс Modal

Общая информация
Управляет общим контейнером модального окна: открытие/закрытие, вставка/очистка контента, закрытие по фону/кнопке.

Конструктор
constructor(container: HTMLElement, events: IEvents)
— принимает #modal-container и шину событий.

Поля класса
- protected _closeButton: HTMLButtonElement — кнопка закрытия (.modal__close).
- protected _contentContainer: HTMLElement — .modal__content, куда вставляется любая вьюшка.

Методы класса
- set content(element: HTMLElement) - заменяет содержимое модального окна на переданный элемент
- open() — делает модалку видимой, добавляя класс modal_active
- close() — прячет модалку, убирая класс modal_active
- render(data: IModalData): HTMLElement - отрисовывает переданное содержимое

#### Класс Page

Общая информация
Обёртка страницы: связывает Header и Gallery, управляет блокировкой прокрутки при открытой модалке.

Конструктор
constructor(container: HTMLElement, events: IEvents)
— принимает document.body (или корень) и шину событий.

Поля класса
- protected _counter: HTMLElement - счетчик корзины
- protected _wrapper: HTMLElement - обертка страницы для управления скроллом страницы
- protected _catalog: HTMLElement - контейнер для карточек ('.gallery')
- protected _basket: HTMLElement - элемент корзины

Методы класса
- set counter(value: number) - обновляет текстовый счетчик корзины в шапке страницы
- set catalog(items: HTMLElement[]) - заменяет содержимое галереи товаров на переданные карточки
- set locked(value: boolean) - включает или выключает "блокировку" страницы

#### Класс Success

Общая информация
Вьюшка результата успешного заказа: простое сообщение с суммой списания и кнопкой для возврата к каталогу.

Конструктор
constructor(container: HTMLElement, actions? ISuccessActions)
— принимает клонированный шаблон success и опциональные действия (onClick для кнопки закрытия).

Поля класса
- protected _close: HTMLButtonElement - кнопка перехода на главную страницу
- protected _total: HTMLElement - элемент с итоговой суммой заказа

Методы класса
- set total(value: number) - устанавливает итоговую стоимость всех товаров

### Слой коммуникации

#### Класс WebLarekAPI
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\

*События изменения данных (модели):*

- `basket:items:updated` – (BasketModel) изменился список товаров в корзине  
- `basket:items:cleared` – (BasketModel) корзина очищена  
- `catalog:products:updated` – (CatalogModel) обновлён список товаров  
- `catalog:selected:changed` – (CatalogModel) изменился выбранный товар  
- `order:customer:updated` – (OrderModel) обновлены данные покупателя  
- `formErrors:change` – (OrderModel) изменилось состояние ошибок формы  
- `order:items:updated` – (OrderModel) изменился список id выбранных товаров  
- `order:total:updated` – (OrderModel) изменилась сумма заказа  
- `order:data:ready` – (OrderModel) собраны все данные заказа для отправки  
- `order:customer:cleared` – (OrderModel) данные покупателя очищены  

*События взаимодействия пользователя (представления / UI):*

- `card:select` – (index.ts) выбран товар в каталоге, открывается превью  
- `basket:item-delete` – (index.ts) клик по кнопке удаления товара из корзины  
- `basket:go-to-order-step` – (index.ts) переход из корзины к форме заказа  
- `order:open` – (index.ts) открыть форму заказа в модальном окне  
- `order:submit` – (index.ts) отправка формы заказа (shipping)  
- `contacts:open` – (index.ts) открыть форму контактов в модальном окне  
- `contacts:submit` – (index.ts) отправка формы контактов  